{"version":3,"file":"shuffle-text.js","sources":["../src/ShuffleText.ts"],"sourcesContent":["/**\n * ShuffleText is random text effect class for DOM Elements.\n * ShuffleTextはDOMエレメント用ランダムテキストクラスです。\n * @author Yasunobu Ikeda\n * @since 2012-02-07\n */\nexport default class ShuffleText {\n  /**\n   * The string for random text.\n   * ランダムテキストに用いる文字列です。\n   * @type {string}\n   * @default 'ABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890'\n   */\n  public sourceRandomCharacter: string = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890';\n\n  /**\n   * The string for effect space.\n   * 空白に用いる文字列です。\n   * @type {string}\n   * @default '-'\n   */\n  public emptyCharacter: string = '-';\n\n  /**\n   * The milli seconds of effect time.\n   * エフェクトの実行時間（ミリ秒）です。\n   * @type {number}\n   * @default 600\n   */\n  public duration: number = 600;\n\n  private _isRunning: boolean = false;\n  private _originalStr: string = '';\n  private _originalLength: number = 0;\n  private _timeCurrent: number = 0;\n  private _timeStart: number = 0;\n  private _randomIndex: number[] = [];\n  private _element: HTMLElement = null;\n  private _requestAnimationFrameId: number = 0;\n\n\n  /**\n   * Constructor.\n   * @param element DOMエレメントです。\n   */\n  constructor(element: HTMLElement) {\n    this._element = element;\n    this.setText(element.innerHTML);\n  }\n\n  /**\n   * Set new strings. テキストを設定します。\n   * @param text テキスト文字列です。\n   */\n  public setText(text: string): void {\n    this._originalStr = text;\n    this._originalLength = text.length;\n  }\n\n  /**\n   * It is running flag. 再生中かどうかを示すブール値です。\n   * @returns {boolean}\n   */\n  public get isRunning(): boolean {\n    return this.isRunning;\n  }\n\n  /** Play effect. 再生を開始します。 */\n  public start(): void {\n    this.stop();\n\n    this._randomIndex = [];\n    let str = '';\n    for (let i = 0; i < this._originalLength; i++) {\n      let rate = i / this._originalLength;\n      this._randomIndex[i] = Math.random() * (1 - rate) + rate;\n      str += this.emptyCharacter;\n    }\n\n    this._timeStart = new Date().getTime();\n    this._isRunning = true;\n\n    this._requestAnimationFrameId = requestAnimationFrame(() => {\n      this._onInterval();\n    });\n\n    this._element.innerHTML = str;\n  }\n\n  /** Stop effect. 停止します。 */\n  public stop(): void {\n    this._isRunning = false;\n    cancelAnimationFrame(this._requestAnimationFrameId);\n  }\n\n  /**\n   * Dispose this instance.\n   * メモリ解放のためインスタンスを破棄します。\n   */\n  public dispose(): void {\n    cancelAnimationFrame(this._requestAnimationFrameId);\n\n    this.sourceRandomCharacter = null;\n    this.emptyCharacter = null;\n    this._isRunning = false;\n    this.duration = 0;\n    this._originalStr = null;\n    this._originalLength = 0;\n    this._timeCurrent = 0;\n    this._timeStart = 0;\n    this._randomIndex = null;\n    this._element = null;\n    this._requestAnimationFrameId = 0;\n  }\n\n  /**\n   * インターバルハンドラーです。\n   * @private\n   */\n  private _onInterval(): void {\n    this._timeCurrent = new Date().getTime() - this._timeStart;\n    const percent = this._timeCurrent / this.duration;\n\n    let str = '';\n    for (let i = 0; i < this._originalLength; i++) {\n      if (percent >= this._randomIndex[i]) {\n        str += this._originalStr.charAt(i);\n      } else if (percent < this._randomIndex[i] / 3) {\n        str += this.emptyCharacter;\n      } else {\n        str += this.sourceRandomCharacter.charAt(Math.floor(Math.random() * (this.sourceRandomCharacter.length)));\n      }\n    }\n\n    if (percent > 1) {\n      str = this._originalStr;\n      this._isRunning = false;\n    }\n    this._element.innerHTML = str;\n\n    if (this._isRunning === true) {\n      this._requestAnimationFrameId = requestAnimationFrame(() => {\n        this._onInterval();\n      });\n    }\n  }\n}\n"],"names":[],"mappings":"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"}