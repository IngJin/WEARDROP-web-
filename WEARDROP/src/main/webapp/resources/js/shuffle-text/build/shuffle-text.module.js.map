{"version":3,"file":"shuffle-text.module.js","sources":["../src/ShuffleText.ts"],"sourcesContent":["/**\n * ShuffleText is random text effect class for DOM Elements.\n * ShuffleTextはDOMエレメント用ランダムテキストクラスです。\n * @author Yasunobu Ikeda\n * @since 2012-02-07\n */\nexport default class ShuffleText {\n  /**\n   * The string for random text.\n   * ランダムテキストに用いる文字列です。\n   * @type {string}\n   * @default 'ABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890'\n   */\n  public sourceRandomCharacter: string = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890';\n\n  /**\n   * The string for effect space.\n   * 空白に用いる文字列です。\n   * @type {string}\n   * @default '-'\n   */\n  public emptyCharacter: string = '-';\n\n  /**\n   * The milli seconds of effect time.\n   * エフェクトの実行時間（ミリ秒）です。\n   * @type {number}\n   * @default 600\n   */\n  public duration: number = 600;\n\n  private _isRunning: boolean = false;\n  private _originalStr: string = '';\n  private _originalLength: number = 0;\n  private _timeCurrent: number = 0;\n  private _timeStart: number = 0;\n  private _randomIndex: number[] = [];\n  private _element: HTMLElement = null;\n  private _requestAnimationFrameId: number = 0;\n\n\n  /**\n   * Constructor.\n   * @param element DOMエレメントです。\n   */\n  constructor(element: HTMLElement) {\n    this._element = element;\n    this.setText(element.innerHTML);\n  }\n\n  /**\n   * Set new strings. テキストを設定します。\n   * @param text テキスト文字列です。\n   */\n  public setText(text: string): void {\n    this._originalStr = text;\n    this._originalLength = text.length;\n  }\n\n  /**\n   * It is running flag. 再生中かどうかを示すブール値です。\n   * @returns {boolean}\n   */\n  public get isRunning(): boolean {\n    return this.isRunning;\n  }\n\n  /** Play effect. 再生を開始します。 */\n  public start(): void {\n    this.stop();\n\n    this._randomIndex = [];\n    let str = '';\n    for (let i = 0; i < this._originalLength; i++) {\n      let rate = i / this._originalLength;\n      this._randomIndex[i] = Math.random() * (1 - rate) + rate;\n      str += this.emptyCharacter;\n    }\n\n    this._timeStart = new Date().getTime();\n    this._isRunning = true;\n\n    this._requestAnimationFrameId = requestAnimationFrame(() => {\n      this._onInterval();\n    });\n\n    this._element.innerHTML = str;\n  }\n\n  /** Stop effect. 停止します。 */\n  public stop(): void {\n    this._isRunning = false;\n    cancelAnimationFrame(this._requestAnimationFrameId);\n  }\n\n  /**\n   * Dispose this instance.\n   * メモリ解放のためインスタンスを破棄します。\n   */\n  public dispose(): void {\n    cancelAnimationFrame(this._requestAnimationFrameId);\n\n    this.sourceRandomCharacter = null;\n    this.emptyCharacter = null;\n    this._isRunning = false;\n    this.duration = 0;\n    this._originalStr = null;\n    this._originalLength = 0;\n    this._timeCurrent = 0;\n    this._timeStart = 0;\n    this._randomIndex = null;\n    this._element = null;\n    this._requestAnimationFrameId = 0;\n  }\n\n  /**\n   * インターバルハンドラーです。\n   * @private\n   */\n  private _onInterval(): void {\n    this._timeCurrent = new Date().getTime() - this._timeStart;\n    const percent = this._timeCurrent / this.duration;\n\n    let str = '';\n    for (let i = 0; i < this._originalLength; i++) {\n      if (percent >= this._randomIndex[i]) {\n        str += this._originalStr.charAt(i);\n      } else if (percent < this._randomIndex[i] / 3) {\n        str += this.emptyCharacter;\n      } else {\n        str += this.sourceRandomCharacter.charAt(Math.floor(Math.random() * (this.sourceRandomCharacter.length)));\n      }\n    }\n\n    if (percent > 1) {\n      str = this._originalStr;\n      this._isRunning = false;\n    }\n    this._element.innerHTML = str;\n\n    if (this._isRunning === true) {\n      this._requestAnimationFrameId = requestAnimationFrame(() => {\n        this._onInterval();\n      });\n    }\n  }\n}\n"],"names":[],"mappings":"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"}